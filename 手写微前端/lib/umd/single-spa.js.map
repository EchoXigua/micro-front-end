{"version":3,"file":"single-spa.js","sources":["../../src/start.js","../../src/navigations/reroute.js","../../src/applications/app.helpers.js","../../src/applications/app.js"],"sourcesContent":["import { reroute } from \"./navigations/reroute\";\r\n\r\nexport let started = false\r\nexport function start() {\r\n  //需要挂载应用\r\n  started = true\r\n  reroute(); //除了去加载应用 还需要去挂载应用\r\n}","import { getAppChanges } from \"../applications/app\";\r\nimport { started } from \"../start\";\r\n\r\nexport function reroute() {\r\n\r\n  /**\r\n   *  需要获取加载的应用\r\n   *  需要获取挂载的应用\r\n   *  哪些应用需要被卸载\r\n   */\r\n  const { appsToLoad, appsToMount, appsToUnmount } = getAppChanges()\r\n  console.log('reroute', appsToLoad, appsToMount, appsToUnmount);\r\n\r\n  if (started) {\r\n    //调用 start 方法\r\n    //app 挂载\r\n\r\n    return performAppChanges()  //根据路径来挂载应用\r\n\r\n  } else {\r\n    //调用 register\r\n    //注册应用时， 需要预先加载\r\n    return loadApps()  //预加载应用\r\n  }\r\n\r\n  async function loadApps() {\r\n\r\n  }\r\n\r\n  async function performAppChanges() {\r\n\r\n  }\r\n}","//秒速应用的整个状态\r\n\r\n//没有加载过，应用初始状态\r\nexport const NOT_LOADED = 'NOT_LOADED'\r\n\r\n//加载资源 \r\nexport const LOADING_SOURCE_CODE = 'LOADING_SOURCE_CODE'\r\n\r\n//还没有调用bootstrap 方法\r\nexport const NOT_BOOTSTRAPPED = 'NOT_BOOTSTRAPPED'\r\n\r\n//启动中\r\nexport const BOOTSTRAPPING = 'BOOTSTRAPPING'\r\n\r\n//没有挂载，没有调用 mount 方法\r\nexport const NOT_MOUNTED = 'NOT_MOUNTED'\r\n\r\n//正在挂载中\r\nexport const MOUNTING = 'MOUNTING'\r\n\r\n//挂载完毕\r\nexport const MOUNTED = 'MOUNTED'\r\n\r\n//更新中，更新完会回到挂载完毕\r\nexport const UPDATING = 'UPDATING'\r\n\r\n//解除卸载，状态变为没有挂载\r\nexport const UNMOUNTING = 'UNMOUNTING'\r\n\r\n//完全卸载中，可能状态变为没有加载过（初始化状态）\r\nexport const UNLOADING = 'UNLOADING'\r\n\r\n//错误处理  资源失败\r\nexport const LOAD_ERR = 'LOAD_ERR'\r\n\r\n//错误处理   代码问题\r\nexport const SKIP_BECAUSE_BROKEN = 'SKIP_BECAUSE_BROKEN'\r\n\r\n//当前应用是否被激活\r\nexport function isActive(app) {\r\n  return app.status === MOUNTED\r\n}\r\n\r\n//当前应用是否要被激活\r\nexport function shouldBeActive(app) {\r\n  //如果返回 true  那么应用应该开始初始化等一系列操作\r\n  return app.activeWhen(window.location)\r\n}\r\n\r\n\r\n","import { reroute } from \"../navigations/reroute\";\r\nimport { LOADING_SOURCE_CODE, NOT_BOOTSTRAPPED, NOT_LOADED, shouldBeActive, SKIP_BECAUSE_BROKEN } from \"./app.helpers\";\r\n\r\n/**\r\n * \r\n * @param {*} appName  应用名字 \r\n * @param {*} loadApp  加载的应用\r\n * @param {*} activeWhen  当激活时会调用 loadApp\r\n * @param {*} customProps 自定义属性\r\n */\r\n\r\n\r\nconst apps = [] //存放所有的应用\r\nexport function registryApplication(appName, loadApp, activeWhen, customProps) {\r\n  apps.push({\r\n    name: appName,\r\n    loadApp,\r\n    activeWhen,\r\n    customProps,\r\n    status: NOT_LOADED\r\n  })\r\n  reroute();//加载应用\r\n}\r\n\r\nexport function getAppChanges() {\r\n  const appsToUnmount = []  //要卸载的app\r\n  const appsToLoad = []  //要加载的app\r\n  const appsToMount = []  //要挂载的app\r\n  apps.forEach(app => {\r\n    // 需不需要被加载\r\n    const appShouldBeActive = shouldBeActive(app)\r\n    switch (app.status) {\r\n      case NOT_LOADED:\r\n      case LOADING_SOURCE_CODE:\r\n        //初始状态 需要去加载 在激活状态下\r\n        if (appShouldBeActive) {\r\n          appsToLoad.push(app)\r\n        }\r\n        break;\r\n      case NOT_BOOTSTRAPPED:\r\n      case BOOTSTRAPPING:\r\n      case NOT_MOUNTED:\r\n        //加载完毕后， 需要去挂载 在激活状态下\r\n        if (appShouldBeActive) {\r\n          appsToMount.push(app)\r\n        }\r\n        break;\r\n      case MOUNTED:\r\n        //处于 挂载完毕的，且不被激活的需要去卸载\r\n        if (!appShouldBeActive) {\r\n          appsToUnmount.push(app)\r\n        }\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  })\r\n\r\n  return {\r\n    appsToUnmount,\r\n    appsToLoad,\r\n    appsToMount\r\n  }\r\n}"],"names":[],"mappings":";;;;;;EAEO,IAAI,OAAO,GAAG,MAAK;EACnB,SAAS,KAAK,GAAG;EACxB;EACA,EAAE,OAAO,GAAG,KAAI;EAChB,EAAE,OAAO,EAAE,CAAC;EACZ;;ECJO,SAAS,OAAO,GAAG;AAC1B;EACA;EACA;EACA;EACA;EACA;EACA,EAAE,MAAM,EAAE,UAAU,EAAE,WAAW,EAAE,aAAa,EAAE,GAAG,aAAa,GAAE;EACpE,EAAE,OAAO,CAAC,GAAG,CAAC,SAAS,EAAE,UAAU,EAAE,WAAW,EAAE,aAAa,CAAC,CAAC;AACjE;EACA,EAAE,IAAI,OAAO,EAAE;EACf;EACA;AACA;EACA,IAAI,OAAO,iBAAiB,EAAE;AAC9B;EACA,GAAG,MAAM;EACT;EACA;EACA,IAAI,OAAO,QAAQ,EAAE;EACrB,GAAG;AACH;EACA,EAAE,eAAe,QAAQ,GAAG;AAC5B;EACA,GAAG;AACH;EACA,EAAE,eAAe,iBAAiB,GAAG;AACrC;EACA,GAAG;EACH;;EChCA;AACA;EACA;EACO,MAAM,UAAU,GAAG,aAAY;AACtC;EACA;EACO,MAAM,mBAAmB,GAAG,sBAAqB;AACxD;EACA;EACO,MAAM,gBAAgB,GAAG,mBAAkB;AAiClD;EACA;EACO,SAAS,cAAc,CAAC,GAAG,EAAE;EACpC;EACA,EAAE,OAAO,GAAG,CAAC,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC;EACxC;;EC5CA;EACA;EACA;EACA;EACA;EACA;EACA;AACA;AACA;EACA,MAAM,IAAI,GAAG,GAAE;EACR,SAAS,mBAAmB,CAAC,OAAO,EAAE,OAAO,EAAE,UAAU,EAAE,WAAW,EAAE;EAC/E,EAAE,IAAI,CAAC,IAAI,CAAC;EACZ,IAAI,IAAI,EAAE,OAAO;EACjB,IAAI,OAAO;EACX,IAAI,UAAU;EACd,IAAI,WAAW;EACf,IAAI,MAAM,EAAE,UAAU;EACtB,GAAG,EAAC;EACJ,EAAE,OAAO,EAAE,CAAC;EACZ,CAAC;AACD;EACO,SAAS,aAAa,GAAG;EAChC,EAAE,MAAM,aAAa,GAAG,GAAE;EAC1B,EAAE,MAAM,UAAU,GAAG,GAAE;EACvB,EAAE,MAAM,WAAW,GAAG,GAAE;EACxB,EAAE,IAAI,CAAC,OAAO,CAAC,GAAG,IAAI;EACtB;EACA,IAAI,MAAM,iBAAiB,GAAG,cAAc,CAAC,GAAG,EAAC;EACjD,IAAI,QAAQ,GAAG,CAAC,MAAM;EACtB,MAAM,KAAK,UAAU,CAAC;EACtB,MAAM,KAAK,mBAAmB;EAC9B;EACA,QAAQ,IAAI,iBAAiB,EAAE;EAC/B,UAAU,UAAU,CAAC,IAAI,CAAC,GAAG,EAAC;EAC9B,SAAS;EACT,QAAQ,MAAM;EACd,MAAM,KAAK,gBAAgB,CAAC;EAC5B,MAAM,KAAK,aAAa,CAAC;EACzB,MAAM,KAAK,WAAW;EACtB;EACA,QAAQ,IAAI,iBAAiB,EAAE;EAC/B,UAAU,WAAW,CAAC,IAAI,CAAC,GAAG,EAAC;EAC/B,SAAS;EACT,QAAQ,MAAM;EACd,MAAM,KAAK,OAAO;EAClB;EACA,QAAQ,IAAI,CAAC,iBAAiB,EAAE;EAChC,UAAU,aAAa,CAAC,IAAI,CAAC,GAAG,EAAC;EACjC,SAAS;EACT,QAAQ,MAAM;EAGd,KAAK;EACL,GAAG,EAAC;AACJ;EACA,EAAE,OAAO;EACT,IAAI,aAAa;EACjB,IAAI,UAAU;EACd,IAAI,WAAW;EACf,GAAG;EACH;;;;;;;;;"}